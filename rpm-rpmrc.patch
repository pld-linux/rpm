--- rpm-4.4.2.2/rpmrc.in	2007-09-27 10:33:19.000000000 +0300
+++ rpm-4.4.2.2-rpmrc/rpmrc.in	2007-12-18 00:38:38.622511289 +0200
@@ -13,71 +13,71 @@
 # Values for RPM_OPT_FLAGS for various platforms
 
 # "fat" binary with both archs, for Darwin
-optflags: fat -O2 -g -arch i386 -arch ppc
+optflags: fat -O2 -arch i386 -arch ppc %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_fat: %{specflags_fat}}}
 
-optflags: i386 -O2 -g -m32 -march=i386 -mtune=generic -fasynchronous-unwind-tables
-optflags: i486 -O2 -g -m32 -march=i486 -fasynchronous-unwind-tables
-optflags: i586 -O2 -g -m32 -march=i586 -fasynchronous-unwind-tables
-optflags: i686 -O2 -g -m32 -march=i686 -mtune=generic -fasynchronous-unwind-tables
-optflags: pentium3 -O2 -g -m32 -march=pentium3 -mtune=generic -fasynchronous-unwind-tables
-optflags: pentium4 -O2 -g -m32 -march=pentium4 -mtune=generic -fasynchronous-unwind-tables
-optflags: athlon -O2 -g -m32 -march=athlon -fasynchronous-unwind-tables
-optflags: ia64 -O2 -g -m64 -mtune=generic
-optflags: x86_64 -O2 -g -m64 -mtune=generic
-optflags: amd64 -O2 -g -mtune=generic
-optflags: ia32e -O2 -g -m64 -mtune=generic
-
-optflags: alpha -O2 -g -mieee
-optflags: alphaev5 -O2 -g -mieee -march=ev5
-optflags: alphaev56 -O2 -g -mieee -march=ev56
-optflags: alphapca56 -O2 -g -mieee -march=pca56
-optflags: alphaev6 -O2 -g -mieee -march=ev6
-optflags: alphaev67 -O2 -g -mieee -march=ev67
-
-optflags: sparc -O2 -g -m32 -mtune=ultrasparc
-optflags: sparcv8 -O2 -g -m32 -mtune=ultrasparc -mv8
-optflags: sparcv9 -O2 -g -m32 -march=ultrasparc
-optflags: sparcv9v -O2 -g -m32 -march=niagara
-optflags: sparc64 -O2 -g -m64 -march=ultrasparc
-optflags: sparc64v -O2 -g -m64 -march=niagara
-
-optflags: m68k -O2 -g -fomit-frame-pointer
-
-optflags: ppc -O2 -g -m32 -fsigned-char
-optflags: ppc8260 -O2 -g -m32 -fsigned-char
-optflags: ppc8560 -O2 -g -m32 -fsigned-char
-optflags: ppc32dy4 -O2 -g -m32 -fsigned-char
-optflags: ppciseries -O2 -g -m32 -fsigned-char
-optflags: ppcpseries -O2 -g -m32 -fsigned-char
-optflags: ppc64 -O2 -g -m64 -fsigned-char
-
-optflags: parisc -O2 -g -mpa-risc-1-0
-optflags: hppa1.0 -O2 -g -mpa-risc-1-0
-optflags: hppa1.1 -O2 -g -mpa-risc-1-0
-optflags: hppa1.2 -O2 -g -mpa-risc-1-0
-optflags: hppa2.0 -O2 -g -mpa-risc-1-0
-
-optflags: mips -O2 -g
-optflags: mipsel -O2 -g
-
-optflags: armv3l -O2 -g -march=armv3
-optflags: armv4b -O2 -g -march=armv4
-optflags: armv4l -O2 -g -march=armv4
-optflags: armv4tl -O2 -g -march=armv4t
-optflags: armv5tel -O2 -g -march=armv5te
-optflags: armv5tejl -O2 -g -march=armv5te
-optflags: armv6l -O2 -g -march=armv6
-
-optflags: atarist -O2 -g -fomit-frame-pointer
-optflags: atariste -O2 -g -fomit-frame-pointer
-optflags: ataritt -O2 -g -fomit-frame-pointer
-optflags: falcon -O2 -g -fomit-frame-pointer
-optflags: atariclone -O2 -g -fomit-frame-pointer
-optflags: milan -O2 -g -fomit-frame-pointer
-optflags: hades -O2 -g -fomit-frame-pointer
+optflags: i386 -O2 -m32 -march=i386 -mtune=generic -fasynchronous-unwind-tables %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ia32: %{specflags_ia32}}%{?specflags_i386: %{specflags_i386}}}
+optflags: i486 -O2 -m32 -march=i486 -fasynchronous-unwind-tables %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ia32: %{specflags_ia32}}%{?specflags_i486: %{specflags_i486}}}
+optflags: i586 -O2 -m32 -march=i586 -fasynchronous-unwind-tables %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ia32: %{specflags_ia32}}%{?specflags_i586: %{specflags_i586}}}
+optflags: i686 -O2 -m32 -march=i686 -mtune=generic -fasynchronous-unwind-tables %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ia32: %{specflags_ia32}}%{?specflags_i686: %{specflags_i686}}}
+optflags: pentium3 -O2 -m32 -march=pentium3 -mtune=generic -fasynchronous-unwind-tables %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ia32: %{specflags_ia32}}%{?specflags_pentium3: %{specflags_pentium3}}}
+optflags: pentium4 -O2 -m32 -march=pentium4 -mtune=generic -fasynchronous-unwind-tables %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ia32: %{specflags_ia32}}%{?specflags_pentium4: %{specflags_pentium4}}}
+optflags: athlon -O2 -m32 -march=athlon -fasynchronous-unwind-tables %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ia32: %{specflags_ia32}}%{?specflags_athlon: %{specflags_athlon}}}
+optflags: ia64 -O2 -m64 -mtune=generic %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ia64: %{specflags_ia64}}}
+optflags: x86_64 -O2 -m64 -mtune=generic %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_x86_64: %{specflags_x86_64}}}
+optflags: amd64 -O2 -mtune=generic %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_amd64: %{specflags_amd64}}}
+optflags: ia32e -O2 -m64 -mtune=generic %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ia32e: %{specflags_ia32e}}}
+
+optflags: alpha -O2 -mieee %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_alpha: %{specflags_alpha}}}
+optflags: alphaev5 -O2 -mieee -march=ev5 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_alpha: %{specflags_alpha}}%{?specflags_alphaev5: %{specflags_alphaev5}}}
+optflags: alphaev56 -O2 -mieee -march=ev56 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_alpha: %{specflags_alpha}}%{?specflags_alphaev56: %{specflags_alphaev56}}}
+optflags: alphapca56 -O2 -mieee -march=pca56 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_alpha: %{specflags_alpha}}%{?specflags_alphapca56: %{specflags_alphapca56}}}
+optflags: alphaev6 -O2 -mieee -march=ev6 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_alpha: %{specflags_alpha}}%{?specflags_alphaev6: %{specflags_alphaev6}}}
+optflags: alphaev67 -O2 -mieee -march=ev67 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_alpha: %{specflags_alpha}}%{?specflags_alphaev67: %{specflags_alphaev67}}}
+
+optflags: sparc -O2 -m32 -mtune=ultrasparc %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_sparc: %{specflags_sparc}}}
+optflags: sparcv8 -O2 -m32 -mtune=ultrasparc -mv8 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_sparc: %{specflags_sparc}}%{?specflags_sparcv8: %{specflags_sparcv8}}}
+optflags: sparcv9 -O2 -m32 -march=ultrasparc %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_sparc: %{specflags_sparc}}%{?specflags_sparcv9: %{specflags_sparcv9}}}
+optflags: sparcv9v -O2 -m32 -march=niagara
+optflags: sparc64 -O2 -m64 -march=ultrasparc %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_sparc: %{specflags_sparc}}%{?specflags_sparc64: %{specflags_sparc64}}}
+optflags: sparc64v -O2 -m64 -march=niagara
+
+optflags: m68k -O2 -fomit-frame-pointer %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_m68k: %{specflags_m68k}}}
+
+optflags: ppc -O2 -m32 -fsigned-char %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ppc: %{specflags_ppc}}}
+optflags: ppc8260 -O2 -m32 -fsigned-char %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ppc8260: %{specflags_ppc8260}}}
+optflags: ppc8560 -O2 -m32 -fsigned-char %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ppc8560: %{specflags_ppc8560}}}
+optflags: ppc32dy4 -O2 -m32 -fsigned-char %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ppc32dy4: %{specflags_ppc32dy4}}}
+optflags: ppciseries -O2 -m32 -fsigned-char %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ppciseries: %{specflags_ppciseries}}}
+optflags: ppcpseries -O2 -m32 -fsigned-char %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ppcpseries: %{specflags_ppcpseries}}}
+optflags: ppc64 -O2 -m64 -fsigned-char %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ppc64: %{specflags_ppc64}}}
+
+optflags: parisc -O2 -mpa-risc-1-0 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_parisc: %{specflags_parisc}}}
+optflags: hppa1.0 -O2 -mpa-risc-1-0 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_hppa1_0: %{specflags_hppa1_0}}}
+optflags: hppa1.1 -O2 -mpa-risc-1-0 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_hppa1_1: %{specflags_hppa1_1}}}
+optflags: hppa1.2 -O2 -mpa-risc-1-0 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_hppa1_2: %{specflags_hppa1_2}}}
+optflags: hppa2.0 -O2 -mpa-risc-1-0 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_hppa2_0: %{specflags_hppa2_0}}}
+
+optflags: mips -O2 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_mips: %{specflags_mips}}}
+optflags: mipsel -O2 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_mips: %{specflags_mips}}%{?specflags_mipsel: %{specflags_mipsel}}}
+
+optflags: armv3l -O2 -march=armv3 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_armv3l: %{specflags_armv3l}}}
+optflags: armv4b -O2 -march=armv4 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_armv4b: %{specflags_armv4b}}}
+optflags: armv4l -O2 -march=armv4 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_armv4l: %{specflags_armv4l}}}
+optflags: armv4tl -O2 -march=armv4t
+optflags: armv5tel -O2 -march=armv5te
+optflags: armv5tejl -O2 -march=armv5te
+optflags: armv6l -O2 -march=armv6
+
+optflags: atarist -O2 -fomit-frame-pointer %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_atarist: %{specflags_atarist}}}
+optflags: atariste -O2 -fomit-frame-pointer %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_atariste: %{specflags_atariste}}}
+optflags: ataritt -O2 -fomit-frame-pointer %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ataritt: %{specflags_ataritt}}}
+optflags: falcon -O2 -fomit-frame-pointer %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_falcon: %{specflags_falcon}}}
+optflags: atariclone -O2 -fomit-frame-pointer %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_atariclone: %{specflags_atariclone}}}
+optflags: milan -O2 -fomit-frame-pointer %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_milan: %{specflags_milan}}}
+optflags: hades -O2 -fomit-frame-pointer %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_hades: %{specflags_hades}}}
 
-optflags: s390 -O2 -g -m31
-optflags: s390x -O2 -g -m64
+optflags: s390 -O2 -m31 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_s390: %{specflags_s390}}}
+optflags: s390x -O2 -m64 %{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_s390: %{specflags_s390}}%{?specflags_s390x: %{specflags_s390x}}}
 
 #############################################################
 # Canonical arch names and numbers
@@ -442,7 +442,7 @@
 buildarch_compat: amd64: x86_64
 buildarch_compat: ia32e: x86_64
 
-macrofiles:	@RPMCONFIGDIR@/macros:@RPMCONFIGDIR@/%{_target}/macros:@SYSCONFIGDIR@/macros.*:@SYSCONFIGDIR@/macros:@SYSCONFIGDIR@/%{_target}/macros:~/.rpmmacros
+macrofiles:	@RPMCONFIGDIR@/macros:@RPMCONFIGDIR@/macros.build:@RPMCONFIGDIR@/%{_target}/macros:@SYSCONFIGDIR@/macros.*:@SYSCONFIGDIR@/macros:@SYSCONFIGDIR@/%{_target}/macros:~/etc/.rpmmacros:~/.rpmmacros
 
 # \endverbatim
 #*/
