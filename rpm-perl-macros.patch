diff -Nru rpm-4.0.1/configure.in rpm-4.0.1.new/configure.in
--- rpm-4.0.1/configure.in	Wed Jan 31 13:37:21 2001
+++ rpm-4.0.1.new/configure.in	Wed Jan 31 13:49:25 2001
@@ -185,6 +185,7 @@
     AC_PATH_PROG(__MKDIR, mkdir, /bin/mkdir, $MYPATH)
     AC_PATH_PROG(__MV, mv, /bin/mv, $MYPATH)
     AC_PATH_PROG(__PATCH, patch, /usr/bin/patch, $MYPATH)
+    AC_PATH_PROG(PERL, perl, /usr/bin/perl, $MYPATH)
     AC_MSG_CHECKING(old version of patch)
     PATCHVERSION=`patch --version 2>&1`
 
@@ -1043,6 +1044,7 @@
 
 AC_CONFIG_SUBDIRS(popt)
 AC_OUTPUT([Doxyfile Makefile rpmrc macros macros.pld platform rpmpopt rpm.spec scripts/brp-redhat
+	macros.perl scripts/perl.req scripts/perl.prov
 	rpmio/Makefile lib/Makefile build/Makefile tools/Makefile
 	scripts/Makefile
 	tests/Makefile tests/rpmrc tests/macros tests/hello-test/Makefile
diff -Nru rpm-4.0.1/macros.in rpm-4.0.1.new/macros.in
--- rpm-4.0.1/macros.in	Wed Jan 31 13:37:21 2001
+++ rpm-4.0.1.new/macros.in	Wed Jan 31 13:38:04 2001
@@ -629,9 +629,11 @@
 #	%{perl_sitearch}/Image
 #	%dir %{perl_sitearch}/auto/Image
 #
+#
+# NOTE: %{perl_sitearch}, %{perl_archlib} and %{perl_sitelib} macros 
+#	has been moved to macros.perl (see info in this file for details).
+#
 %requires_eq()	%(LC_ALL="C" rpm -q --queryformat 'Requires:%%{NAME} = %%{VERSION}' %1| grep -v "is not")
-%perl_sitearch	%(eval "`perl -V:installsitearch`"; echo $installsitearch)
-%perl_archlib	%(eval "`perl -V:installarchlib`"; echo $installarchlib)
 
 #------------------------------------------------------------------------------
 # arch macro for all Intel i?86 compatibile processors
diff -Nru rpm-4.0.1/scripts/Makefile.am rpm-4.0.1.new/scripts/Makefile.am
--- rpm-4.0.1/scripts/Makefile.am	Wed Jan 31 13:37:21 2001
+++ rpm-4.0.1.new/scripts/Makefile.am	Wed Jan 31 14:27:28 2001
@@ -9,7 +9,8 @@
 	find-prov.pl find-req.pl cpanflute find-provides.perl \
 	find-requires.perl get_magic.pl getpo.sh http.req \
 	magic.prov magic.req perl.prov perl.req rpmdiff rpmdiff.cgi \
-	trpm u_pkg.sh vpkg-provides.sh vpkg-provides2.sh
+	trpm u_pkg.sh vpkg-provides.sh vpkg-provides2.sh \
+	find-perl-requires find-perl-provides
 
 installprefix = $(DESTDIR)
 
@@ -23,4 +24,5 @@
 	find-prov.pl find-req.pl cpanflute find-provides.perl \
 	find-requires.perl get_magic.pl getpo.sh http.req \
 	magic.prov magic.req perl.prov perl.req rpmdiff rpmdiff.cgi u_pkg.sh \
-	vpkg-provides.sh vpkg-provides2.sh
+	vpkg-provides.sh vpkg-provides2.sh \
+	find-perl-requires find-perl-provides
diff -Nru rpm-4.0.1/scripts/perl.prov rpm-4.0.1.new/scripts/perl.prov
--- rpm-4.0.1/scripts/perl.prov	Wed Jan 31 13:37:21 2001
+++ rpm-4.0.1.new/scripts/perl.prov	Wed Jan 31 13:38:04 2001
@@ -47,7 +47,9 @@
 
 if ("@ARGV") {
   foreach (@ARGV) {
-    process_file($_);
+     if (! m=(/(doc|usr/src)/|\.(so|gz|ph|pod|h|html)$)=) {
+      process_file($_);
+    }
   }
 } else {
 
@@ -55,7 +57,9 @@
   # contents of the file.
 
   foreach (<>) {
-    process_file($_);
+     if (! m=(/(doc|usr/src)/|\.(so|gz|ph|pod|h|html)$)=) {
+      process_file($_);
+    }
   }
 }
 
diff -Nru rpm-4.0.1/scripts/perl.req rpm-4.0.1.new/scripts/perl.req
--- rpm-4.0.1/scripts/perl.req	Wed Jan 31 13:37:21 2001
+++ rpm-4.0.1.new/scripts/perl.req	Wed Jan 31 13:38:04 2001
@@ -1,4 +1,4 @@
-#!/usr/bin/perl
+#!@PERL@
 
 # RPM (and it's source code) is covered under two separate licenses. 
 
@@ -41,7 +41,11 @@
 
 if ("@ARGV") {
   foreach (@ARGV) {
-    process_file($_);
+    if (m=/usr/(sbin|bin|lib|share|X11R6/(lib|bin))/=) {
+      if (! m=(/(doc|man|info|usr/src)/|\.(so|ph|h|html|pod)$)=) {
+        process_file($_);
+      }
+    }
   }
 } else {
   
@@ -49,14 +53,22 @@
   # contents of the file.
   
   foreach (<>) {
-    process_file($_);
+     if (m=/usr/(sbin|bin|lib|share|X11R6/(lib|bin))/=) {
+       if (! m=(/(doc|man|info|usr/src)/|\.(so|ph|h|html|pod)$)=) {
+         process_file($_);
+       }
+     }
   }
 }
 
 
 foreach $module (sort keys %require) {
   if (length($require{$module}) == 0) {
-    print "perl($module)\n";
+     if ($module =~ /^[0-9._]+$/) {
+       print "perl >= $module\n";
+     } else {
+         print "perl($module)\n";
+     }
   } else {
 
     # I am not using rpm3.0 so I do not want spaces arround my
@@ -183,7 +195,31 @@
       # will be included with the name sys/systeminfo.ph so only use the
       # basename of *.ph files
 
-      ($module  =~ m/\.ph$/) && ($module =~ s!.*/!!g );
+      # ($module  =~ m/\.ph$/) && ($module =~ s!.*/!!g );
+
+      # there is no need to generate dependencies for ph, pl or test files
+      # so let's just skip them.
+
+      ($module =~ m/\.(ph|pl|t)$/) && next;
+
+      # skip all modules for platforms other than linux.
+
+      ($module =~ m/Mac|OS2|MSDOS|Win32|VMS|vmsish/) && next;
+
+      # if the module name starts in a dot it is not a module name.
+
+      ($module =~ m/^\./) && next;
+
+      # if the module ends with .pm strip it to leave only basename.
+
+      $module =~ s/\.pm$//;
+
+      $module =~ s/\//::/;
+
+      # trim off trailing parenthesis if any.  Sometimes people pass
+      # the module an empty list.
+
+      $module =~ s/\(\s*\)$//;
 
 
       $require{$module}=$version;
