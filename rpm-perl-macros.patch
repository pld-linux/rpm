diff -ruN rpm-3.0.3/macros.in rpm-3.0.3.new/macros.in
--- rpm-3.0.3/macros.in	Sat Oct 30 11:59:36 1999
+++ rpm-3.0.3.new/macros.in	Sat Oct 30 11:24:39 1999
@@ -248,6 +248,8 @@
 #	%{perl_sitearch}/Image
 #	%dir %{perl_sitearch}/auto/Image
 #
+#
+# NOTE: %{perl_sitearch}, %{perl_archlib} and %{perl_sitelib} macros 
+#	has been moved to macros.perl (see info in this file for details).
+#
 %requires_eq()	%(LC_ALL="C" rpm -q --queryformat 'Requires:%%{NAME} = %%{VERSION}' %1| grep -v "is not")
-%perl_sitearch	%(eval "`perl -V:installsitearch`"; echo $installsitearch)
-%perl_archlib	%(eval "`perl -V:installarchlib`"; echo $installarchlib)
diff -ruN rpm-3.0.3/macros.perl.in rpm-3.0.3.new/macros.perl.in
--- rpm-3.0.3/macros.perl.in	Thu Jan  1 01:00:00 1970
+++ rpm-3.0.3.new/macros.perl.in	Sat Oct 30 11:24:39 1999
@@ -0,0 +1,11 @@
+# Perl specific macro definitions.
+# To make use of these macros insert the following line into your spec file:
+# %include @RPMCONFIGDIR@/macros.perl
+
+%define		__find_requires	@RPMCONFIGDIR@/find-perl-requires
+%define		__find_provides	@RPMCONFIGDIR@/find-perl-provides
+
+%define		perl_sitelib	%(eval "`perl -V:installsitelib`"; echo $installsitelib)
+%define		perl_sitearch	%(eval "`perl -V:installsitearch`"; echo $installsitearch)
+%define		perl_archlib	%(eval "`perl -V:installarchlib`"; echo $installarchlib)
+
diff -ruN rpm-3.0.3/scripts/Makefile.am rpm-3.0.3.new/scripts/Makefile.am
--- rpm-3.0.3/scripts/Makefile.am	Sat Jun  5 22:52:30 1999
+++ rpm-3.0.3.new/scripts/Makefile.am	Sat Oct 30 11:24:39 1999
@@ -4,7 +4,8 @@
 
 EXTRA_DIST = \
 	convertrpmrc.sh find-lang.sh freshen.sh getpo.sh \
-	perl.prov perl.req vpkg-provides.sh
+	perl.prov perl.req find-perl-requires find-perl-provides \
+	vpkg-provides.sh
 
 installprefix = $(DESTDIR)
 
@@ -13,5 +14,6 @@
 configdir = ${prefix}/lib/rpm
 config_SCRIPTS = \
 	convertrpmrc.sh find-lang.sh freshen.sh getpo.sh \
-	perl.prov perl.req vpkg-provides.sh
+	perl.prov perl.req find-perl-requires find-perl-provides \
+	vpkg-provides.sh
 
diff -ruN rpm-3.0.3/scripts/find-perl-provides rpm-3.0.3.new/scripts/find-perl-provides
--- rpm-3.0.3/scripts/find-perl-provides	Thu Jan  1 01:00:00 1970
+++ rpm-3.0.3.new/scripts/find-perl-provides	Sat Oct 30 11:24:39 1999
@@ -0,0 +1,8 @@
+#!/bin/sh
+ulimit -c 0
+
+filelist=`sed "s/['\"]/\\\&/g"`
+
+echo $filelist|/usr/lib/rpm/find-provides
+/usr/lib/rpm/perl.prov $filelist
+
diff -ruN rpm-3.0.3/scripts/find-perl-requires rpm-3.0.3.new/scripts/find-perl-requires
--- rpm-3.0.3/scripts/find-perl-requires	Thu Jan  1 01:00:00 1970
+++ rpm-3.0.3.new/scripts/find-perl-requires	Sat Oct 30 11:24:39 1999
@@ -0,0 +1,11 @@
+#!/bin/sh
+ulimit -c 0
+
+filelist=`sed "s/['\"]/\\\&/g"`
+
+requires="`echo $filelist|/usr/lib/rpm/find-requires`"
+requires_perl="`/usr/lib/rpm/perl.req $filelist`"
+requires_mod="`rpm -q --whatprovides --qf "%{NAME}\n"  $requires_perl 2>/dev/null`"
+echo "$requires
+$requires_perl
+$requires_mod"|  sort -u
diff -ruN rpm-3.0.3/scripts/perl.prov rpm-3.0.3.new/scripts/perl.prov
--- rpm-3.0.3/scripts/perl.prov	Sat Jun  5 22:52:31 1999
+++ rpm-3.0.3.new/scripts/perl.prov	Sat Oct 30 11:24:39 1999
@@ -1,4 +1,4 @@
-#!/usr/bin/perl
+#!@PERL@
 
 # a simple script to print the proper name for perl libraries.
 
@@ -30,12 +30,12 @@
   if (length($require{$module}) == 0) {
     print "perl($module)\n";
   } else {
-    print "perl($module)=$require{$module}\n";
+    print "perl($module) = $require{$module}\n";
 
     # we need to print it without the version number until the
     # requires syntax accepts version numbers correctly.
 
-    print "perl($module)\n";
+#    print "perl($module)\n";
   }
 }
 
diff -ruN rpm-3.0.3/scripts/perl.req rpm-3.0.3.new/scripts/perl.req
--- rpm-3.0.3/scripts/perl.req	Sat Jun  5 22:52:31 1999
+++ rpm-3.0.3.new/scripts/perl.req	Sat Oct 30 11:50:03 1999
@@ -1,4 +1,4 @@
-#!/usr/bin/perl
+#!@PERL@
 
 # a simple makedepends like script for perl.
 
@@ -12,7 +12,11 @@
 
 if ("@ARGV") {
   foreach (@ARGV) {
-    process_file($_);
+    if (m=/usr/(bin|lib|share|X11R6/(lib|bin))/=) {
+      if (! m=(/((doc|man|info)|/usr/src)/)\.so$)=) {
+        process_file($_);
+      }
+    }
   }
 } else {
   
@@ -20,22 +24,30 @@
   # contents of the file.
   
   foreach (<>) {
-    process_file($_);
+    if (m=/usr/(bin|lib|share|X11R6/(lib|bin))/=) {
+      if (! m=(/((doc|man|info)|/usr/src)/)\.so$)=) {
+        process_file($_);
+      }
+    }
   }
 }
 
 
 foreach $module (sort keys %require) {
   if (length($require{$module}) == 0) {
-    print "perl($module)\n";
+    if ($module =~ /^[0-9._]+$/) {
+      print "perl >= $module\n";
+    } else {
+      print "perl($module)\n";
+    }
   } else {
 
-    print "perl($module)>=$require{$module}\n";
+    print "perl($module) >= $require{$module}\n";
 
     # we need to print it without the version number until the
     # requires syntax accepts version numbers correctly.
 
-    print "perl($module)\n";
+#    print "perl($module)\n";
   }
 }
 
@@ -54,7 +66,7 @@
   while (<FILE>) {
     
     # skip the documentation
-    if ( (m/^=(head1|head2|pod)/) .. (m/^=(cut)/) ) {
+    if ( (m/^=(head1|head2|pod|item)/) .. (m/^=(cut)/) ) {
       next;
     }
 
