diff -urN rpm-4.0.4.org/scripts/perl.prov.in rpm-4.0.4/scripts/perl.prov.in
--- rpm-4.0.4.org/scripts/perl.prov.in	Mon Mar 11 10:43:59 2002
+++ rpm-4.0.4/scripts/perl.prov.in	Mon Mar 11 10:45:12 2002
@@ -47,7 +47,7 @@
 
 if ("@ARGV") {
   foreach (@ARGV) {
-     if (! m=(/(doc|usr/src)/|\.(so|gz|ph|pod|h|html)$)=) {
+     if (! m=(/(doc|usr/src)/|\.(so|gz|ph|pod|h|html|al|ix)$)=) {
       process_file($_) if -f "$_";
     }
   }
@@ -57,7 +57,7 @@
   # contents of the file.
 
   foreach (<>) {
-     if (! m=(/(doc|usr/src)/|\.(so|gz|ph|pod|h|html)$)=) {
+     if (! m=(/(doc|usr/src)/|\.(so|gz|ph|pod|h|html|al|ix)$)=) {
       process_file($_) if -f "$_";
     }
   }
@@ -128,7 +128,7 @@
     # package name so we report all namespaces as if they were
     # provided packages (really ugly).
 
-    if (m/^\s*package\s+([_:a-zA-Z0-9]+)\s*;/) {
+    if (m/^\s*package\s+([_:a-zA-Z0-9]+)\s*;/ && $1 ne 'main' && !$require{$1}) {
       $package=$1;
       undef $version;
       $require{$package}=undef;
@@ -144,10 +144,15 @@
     #ExtUtils/Install.pm:$VERSION = substr q$Revision$, 10;
     #CGI/Apache.pm:$VERSION = (qw$Revision$)[1];
     #DynaLoader.pm:$VERSION = $VERSION = "1.03";     # avoid typo warning
+    #Cwd.pm:our $VERSION = '2.04';
+
+    # here is example of VERSION line from RPC::PlClient module
+
+    # RPC/PlClient.pm:$RPC::PlClient::VERSION = '0.2016';
 
     if ( 
 	($package) && 
-	(m/^\s*\$VERSION\s*=\s+/)
+	(m/^\s*(our)?\s*\$(${package}::)?VERSION\s*=/)
        ) {
 
       # first see if the version string contains the string
