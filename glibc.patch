diff -upr rpm-5.4.15.org/rpmio/gzdio.c rpm-5.4.15/rpmio/gzdio.c
--- rpm-5.4.15.org/rpmio/gzdio.c	2012-04-16 05:21:22.000000000 +0200
+++ rpm-5.4.15/rpmio/gzdio.c	2018-08-11 12:36:48.761296851 +0200
@@ -380,7 +380,7 @@ static int gzdSeek(void * cookie, _libio
     int rc;
 #if defined(HAVE_GZSEEK)
 #ifdef USE_COOKIE_SEEK_POINTER
-    _IO_off64_t p = *pos;
+    off64_t p = *pos;
 #else
     off_t p = pos;
 #endif
diff -upr rpm-5.4.15.org/rpmio/rpmio.c rpm-5.4.15/rpmio/rpmio.c
--- rpm-5.4.15.org/rpmio/rpmio.c	2014-08-05 00:47:16.000000000 +0200
+++ rpm-5.4.15/rpmio/rpmio.c	2018-08-11 12:36:48.757963417 +0200
@@ -481,7 +481,7 @@ static int fdSeek(void * cookie, _libio_
 	/*@modifies fileSystem, internalState @*/
 {
 #ifdef USE_COOKIE_SEEK_POINTER
-    _IO_off64_t p = *pos;
+    off64_t p = *pos;
 #else
     off_t p = pos;
 #endif
@@ -2458,7 +2458,7 @@ int Fseek(FD_t fd, _libio_off_t offset,
 {
     fdio_seek_function_t _seek;
 #ifdef USE_COOKIE_SEEK_POINTER
-    _IO_off64_t o64 = offset;
+    off64_t o64 = offset;
     _libio_pos_t pos = &o64;
 #else
     _libio_pos_t pos = offset;
diff -upr rpm-5.4.15.org/rpmio/rpmio.h rpm-5.4.15/rpmio/rpmio.h
--- rpm-5.4.15.org/rpmio/rpmio.h	2014-07-20 01:01:26.000000000 +0200
+++ rpm-5.4.15/rpmio/rpmio.h	2018-08-11 12:36:48.761296851 +0200
@@ -1,6 +1,10 @@
 #ifndef	H_RPMIO
 #define	H_RPMIO
 
+#ifndef	_GNU_SOURCE
+#define	_GNU_SOURCE	1
+#endif
+
 /** \ingroup rpmio
  * \file rpmio/rpmio.h
  *
@@ -25,7 +25,7 @@
 #if !defined(__LCLINT__) && !defined(__UCLIBC__) && defined(__GLIBC__) && \
 	(__GLIBC__ > 2 || (__GLIBC__ == 2 && __GLIBC_MINOR__ >= 2))
 #define USE_COOKIE_SEEK_POINTER 1
-typedef _IO_off64_t 	_libio_off_t;
+typedef off64_t 	_libio_off_t;
 typedef _libio_off_t *	_libio_pos_t;
 #else
 typedef off_t 		_libio_off_t;
