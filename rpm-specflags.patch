--- rpm-4.3.orig/rpmrc.in	Mon Apr 28 16:04:32 2003
+++ rpm-4.3/rpmrc.in	Thu May  1 17:46:04 2003
@@ -11,56 +11,56 @@
 #############################################################
 # Values for RPM_OPT_FLAGS for various platforms
 
-optflags: i386 -O2 -march=i386
+optflags: i386 -O2 -march=i386%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ia32: %{specflags_ia32}}%{?specflags_i386: %{specflags_i386}}}
 #optflags: i386 -O2 -march=i386 -mcpu=i686
-optflags: i486 -O2 -march=i486
-optflags: i586 -O2 -march=i586
-optflags: i686 -O2 -march=i686
-optflags: athlon -O2 -march=athlon
-optflags: ia64 -O2 
-optflags: x86_64 -O2 
-
-optflags: alpha -O2 -mieee
-optflags: alphaev5 -O2  -mieee -mcpu=ev5
-optflags: alphaev56 -O2  -mieee -mcpu=ev56
-optflags: alphapca56 -O2  -mieee -mcpu=pca56
-optflags: alphaev6 -O2  -mieee -mcpu=ev6
-optflags: alphaev67 -O2  -mieee -mcpu=ev67
-
-optflags: sparc -O2  -m32 -mtune=ultrasparc
-optflags: sparcv9 -O2  -m32 -mcpu=ultrasparc
-optflags: sparc64 -O2  -m64 -mcpu=ultrasparc
-
-optflags: m68k -O2  -fomit-frame-pointer
-
-optflags: ppc -O2  -fsigned-char
-optflags: ppciseries -O2  -fsigned-char
-optflags: ppcpseries -O2  -fsigned-char
-optflags: ppc64 -O2  -fsigned-char
-
-optflags: parisc -O2  -mpa-risc-1-0
-optflags: hppa1.0 -O2  -mpa-risc-1-0
-optflags: hppa1.1 -O2  -mpa-risc-1-0
-optflags: hppa1.2 -O2  -mpa-risc-1-0
-optflags: hppa2.0 -O2  -mpa-risc-1-0
-
-optflags: mips -O2 
-optflags: mipsel -O2 
-
-optflags: armv3l -O2  -fsigned-char -fomit-frame-pointer -march=armv3
-optflags: armv4b -O2  -fsigned-char -fomit-frame-pointer -march=armv4
-optflags: armv4l -O2  -fsigned-char -fomit-frame-pointer -march=armv4
-
-optflags: atarist -O2  -fomit-frame-pointer
-optflags: atariste -O2  -fomit-frame-pointer
-optflags: ataritt -O2  -fomit-frame-pointer
-optflags: falcon -O2  -fomit-frame-pointer
-optflags: atariclone -O2  -fomit-frame-pointer
-optflags: milan -O2  -fomit-frame-pointer
-optflags: hades -O2  -fomit-frame-pointer
+optflags: i486 -O2 -march=i486%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ia32: %{specflags_ia32}}%{?specflags_i486: %{specflags_i486}}}
+optflags: i586 -O2 -march=i586%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ia32: %{specflags_ia32}}%{?specflags_i486: %{specflags_i586}}}
+optflags: i686 -O2 -march=i686%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ia32: %{specflags_ia32}}%{?specflags_i486: %{specflags_i686}}}
+optflags: athlon -O2 -march=athlon%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ia32: %{specflags_ia32}}%{?specflags_athlon: %{specflags_athlon}}}
+optflags: ia64 -O2%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ia64: %{specflags_ia64}}}
+optflags: x86_64 -O2%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_x86_64: %{specflags_x86_64}}}
+
+optflags: alpha -O2 -mieee%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_alpha: %{specflags_alpha}}}
+optflags: alphaev5 -O2 -mieee -mcpu=ev5%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_alpha: %{specflags_alpha}}%{?specflags_alphaev5: %{specflags_alphaev5}}}
+optflags: alphaev56 -O2 -mieee -mcpu=ev56%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_alpha: %{specflags_alpha}}%{?specflags_alphaev56: %{specflags_alphaev56}}}
+optflags: alphapca56 -O2 -mieee -mcpu=pca56%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_alpha: %{specflags_alpha}}%{?specflags_alphapca56: %{specflags_alphapca56}}}
+optflags: alphaev6 -O2 -mieee -mcpu=ev6%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_alpha: %{specflags_alpha}}%{?specflags_alphaev6: %{specflags_alphaev6}}}
+optflags: alphaev67 -O2 -mieee -mcpu=ev67%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_alpha: %{specflags_alpha}}%{?specflags_alphaev67: %{specflags_alphaev67}}}
+
+optflags: sparc -O2 -m32 -mtune=ultrasparc%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_sparc: %{specflags_sparc}}}
+optflags: sparcv9 -O2 -m32 -mcpu=ultrasparc%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_sparc: %{specflags_sparc}}%{?specflags_sparcv9: %{specflags_sparcv9}}}
+optflags: sparc64 -O2 -m64 -mcpu=ultrasparc%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_sparc: %{specflags_sparc}}%{?specflags_sparc64: %{specflags_sparc64}}}
+
+optflags: m68k -O2 -fomit-frame-pointer%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_m68k: %{specflags_m68k}}}
+
+optflags: ppc -O2 -fsigned-char%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ppc: %{specflags_ppc}}}
+optflags: ppciseries -O2 -fsigned-char%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ppc: %{specflags_ppc}}%{?specflags_ppciseries: %{specflags_ppciseries}}}
+optflags: ppcpseries -O2 -fsigned-char%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ppc: %{specflags_ppc}}%{?specflags_ppcpseries: %{specflags_ppcpseries}}}
+optflags: ppc64 -O2 -fsigned-char%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ppc: %{specflags_ppc}}%{?specflags_ppc64: %{specflags_ppc64}}}
+
+optflags: parisc -O2 -mpa-risc-1-0%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_parisc: %{specflags_parisc}}}
+optflags: hppa1.0 -O2 -mpa-risc-1-0%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_hppa1_0: %{specflags_hppa1_0}}}
+optflags: hppa1.1 -O2 -mpa-risc-1-0%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_hppa1_1: %{specflags_hppa1_1}}}
+optflags: hppa1.2 -O2 -mpa-risc-1-0%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_hppa1_2: %{specflags_hppa1_2}}}
+optflags: hppa2.0 -O2 -mpa-risc-1-0%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_hppa2_0: %{specflags_hppa2_0}}}
+
+optflags: mips -O2%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_mips: %{specflags_mips}}}
+optflags: mipsel -O2%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_mips: %{specflags_mips}}%{?specflags_mipsel: %{specflags_mipsel}}}
+
+optflags: armv3l -O2 -fsigned-char -fomit-frame-pointer -march=armv3%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_armv3l: %{specflags_armv3l}}}
+optflags: armv4b -O2 -fsigned-char -fomit-frame-pointer -march=armv4%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_armv4b: %{specflags_armv4b}}}
+optflags: armv4l -O2 -fsigned-char -fomit-frame-pointer -march=armv4%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_armv4l: %{specflags_armv4l}}}
+
+optflags: atarist -O2 -fomit-frame-pointer%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_atarist: %{specflags_atarist}}}
+optflags: atariste -O2 -fomit-frame-pointer%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_atariste: %{specflags_atariste}}}
+optflags: ataritt -O2 -fomit-frame-pointer%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_ataritt: %{specflags_ataritt}}}
+optflags: falcon -O2 -fomit-frame-pointer%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_falcon: %{specflags_falcon}}}
+optflags: atariclone -O2 -fomit-frame-pointer%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_atariclone: %{specflags_atariclone}}}
+optflags: milan -O2 -fomit-frame-pointer%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_milan: %{specflags_milan}}}
+optflags: hades -O2 -fomit-frame-pointer%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_hades: %{specflags_hades}}}
 
-optflags: s390 -O2 
-optflags: s390x -O2 
+optflags: s390 -O2%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_s390: %{specflags_s390}}}
+optflags: s390x -O2%{!?nospecflags:%{?specflags: %{specflags}}%{?specflags_s390: %{specflags_s390}}%{?specflags_s390x: %{specflags_s390x}}}
 
 #############################################################
 # Canonical arch names and numbers
--- rpm-4.3.orig/macros.in	Mon Apr 28 16:04:32 2003
+++ rpm-4.3/macros.in	Thu May  1 18:08:53 2003
@@ -1505,3 +1505,46 @@
 %xmms_effect_plugindir        %(xmms-config --effect-plugin-dir)
 %xmms_general_plugindir       %(xmms-config --general-plugin-dir)
 
+# don't define as empty (some autoconf issues when CFLAGS end with multiple spaces)
+#%specflags		%{nil}
+#%specflags_ia32		%{nil}
+#%specflags_i386		%{nil}
+#%specflags_i486		%{nil}
+#%specflags_i586		%{nil}
+#%specflags_i686		%{nil}
+#%specflags_athlon	%{nil}
+#%specflags_ia64		%{nil}
+#%specflags_x86_64	%{nil}
+#%specflags_alpha	%{nil}
+#%specflags_alphaev5	%{nil}
+#%specflags_alphaev56	%{nil}
+#%specflags_alphapca56	%{nil}
+#%specflags_alphaev6	%{nil}
+#%specflags_alphaev67	%{nil}
+#%specflags_sparc	%{nil}
+#%specflags_sparcv9	%{nil}
+#%specflags_sparc64	%{nil}
+#%specflags_m68k		%{nil}
+#%specflags_ppc		%{nil}
+#%specflags_ppciseries	%{nil}
+#%specflags_ppcpseries	%{nil}
+#%specflags_ppc64	%{nil}
+#%specflags_parisc	%{nil}
+#%specflags_hppa1_0	%{nil}
+#%specflags_hppa1_1	%{nil}
+#%specflags_hppa1_1	%{nil}
+#%specflags_hppa2_0	%{nil}
+#%specflags_mips		%{nil}
+#%specflags_mipsel	%{nil}
+#%specflags_armv3l	%{nil}
+#%specflags_armv4b	%{nil}
+#%specflags_armv4l	%{nil}
+#%specflags_atarist	%{nil}
+#%specflags_atariste	%{nil}
+#%specflags_ataritt	%{nil}
+#%specflags_falcon	%{nil}
+#%specflags_atariclone	%{nil}
+#%specflags_milan	%{nil}
+#%specflags_hades	%{nil}
+#%specflags_s390		%{nil}
+#%specflags_s390x	%{nil}
