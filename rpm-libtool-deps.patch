--- rpm-5.4.16/scripts/libtooldeps.sh~	2015-04-20 19:42:37.000000000 +0300
+++ rpm-5.4.16/scripts/libtooldeps.sh	2016-03-16 00:18:07.723298527 +0200
@@ -5,6 +5,8 @@
     exit 0
 }
 
+pkgname="$3"
+
 case $1 in
 -P|--provides)
     shift
@@ -13,7 +15,7 @@
     do
 	case "$possible" in
 	*.la)
-	    if grep -iq '^# Generated by ltmain.sh' "$possible" 2> /dev/null ; then
+	    if file -L "$possible" | grep -iq 'libtool library file' 2> /dev/null ; then
 		possible="$(echo ${possible} | sed -e s,${RPM_BUILD_ROOT}/,/,)"
 		echo "libtool($possible)"
 	    fi
@@ -22,21 +24,28 @@
     done
     ;;
 -R|--requires)
-    while read possible ; do
-	case "$possible" in
-	*.la)
-	    for dep in $(grep '^dependency_libs='"$possible" 2> /dev/null | \
-			sed -e "s,^dependency_libs='\(.*\)',\1,g")
-	    do
-		case "$dep" in
-		/*.la)
-		    echo "libtool($dep)"
-		    ;;
+	case $pkgname in
+	*-devel)
+		while read possible; do
+		case "$possible" in
+		*.la)
+			for dep in $(grep '^dependency_libs=' "$possible" 2> /dev/null | \
+				sed -e "s,^dependency_libs='\(.*\)',\1,g")
+			do
+			case "$dep" in
+			/*.la)
+				dep="$(readlink -f "$dep" 2> /dev/null || echo "$dep")"
+				echo "libtool($dep)"
+				;;
+			esac
+			done
+			;;
 		esac
-	    done
-	    ;;
+		done
+	;;
+	*)
+		cat > /dev/null
+	;;
 	esac
-    done
-    ;;
 esac
 exit 0
