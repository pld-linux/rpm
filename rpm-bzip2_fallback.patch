--- rpm-4.4.6/build/pack.c.old	2006-09-08 20:06:51.000000000 +0200
+++ rpm-4.4.6/build/pack.c	2006-09-08 20:12:46.000000000 +0200
@@ -557,6 +557,13 @@
 	payload_format = _free(payload_format);
 	payload_format = xstrdup("cpio");
     }
+    /* Fallback to bzip2 when lzma is not installed. */
+    if (rpmio_flags && !strcmp(rpmio_flags, "w9.lzdio")) {
+	if (access("/usr/bin/lzma", X_OK)) {
+	    rpmio_flags = _free(rpmio_flags);
+	    rpmio_flags = xstrdup("w9.bzdio");
+	}
+    }
     if (!(rpmio_flags && *rpmio_flags)) {
 	rpmio_flags = _free(rpmio_flags);
 	rpmio_flags = xstrdup("w9.gzdio");
